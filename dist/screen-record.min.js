!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["screen-record"]=t():e["screen-record"]=t()}(this,(()=>(()=>{var e={10:(e,t,n)=>{e.exports=n(225)},520:(e,t,n)=>{"use strict";var r="win32"===process.platform,o=n(539);function i(e,t){for(var n=[],r=0;r<e.length;r++){var o=e[r];o&&"."!==o&&(".."===o?n.length&&".."!==n[n.length-1]?n.pop():t&&n.push(".."):n.push(o))}return n}function s(e){for(var t=e.length-1,n=0;n<=t&&!e[n];n++);for(var r=t;r>=0&&!e[r];r--);return 0===n&&r===t?e:n>r?[]:e.slice(n,r+1)}var a=/^([a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/]+[^\\\/]+)?([\\\/])?([\s\S]*?)$/,c=/^([\s\S]*?)((?:\.{1,2}|[^\\\/]+?|)(\.[^.\/\\]*|))(?:[\\\/]*)$/,l={};function u(e){var t=a.exec(e),n=(t[1]||"")+(t[2]||""),r=t[3]||"",o=c.exec(r);return[n,o[1],o[2],o[3]]}function p(e){var t=a.exec(e),n=t[1]||"",r=!!n&&":"!==n[1];return{device:n,isUnc:r,isAbsolute:r||!!t[2],tail:t[3]}}function f(e){return"\\\\"+e.replace(/^[\\\/]+/,"").replace(/[\\\/]+/g,"\\")}l.resolve=function(){for(var e="",t="",n=!1,r=arguments.length-1;r>=-1;r--){var s;if(r>=0?s=arguments[r]:e?(s=process.env["="+e])&&s.substr(0,3).toLowerCase()===e.toLowerCase()+"\\"||(s=e+"\\"):s=process.cwd(),!o.isString(s))throw new TypeError("Arguments to path.resolve must be strings");if(s){var a=p(s),c=a.device,l=a.isUnc,u=a.isAbsolute,d=a.tail;if((!c||!e||c.toLowerCase()===e.toLowerCase())&&(e||(e=c),n||(t=d+"\\"+t,n=u),e&&n))break}}return l&&(e=f(e)),e+(n?"\\":"")+(t=i(t.split(/[\\\/]+/),!n).join("\\"))||"."},l.normalize=function(e){var t=p(e),n=t.device,r=t.isUnc,o=t.isAbsolute,s=t.tail,a=/[\\\/]$/.test(s);return(s=i(s.split(/[\\\/]+/),!o).join("\\"))||o||(s="."),s&&a&&(s+="\\"),r&&(n=f(n)),n+(o?"\\":"")+s},l.isAbsolute=function(e){return p(e).isAbsolute},l.join=function(){for(var e=[],t=0;t<arguments.length;t++){var n=arguments[t];if(!o.isString(n))throw new TypeError("Arguments to path.join must be strings");n&&e.push(n)}var r=e.join("\\");return/^[\\\/]{2}[^\\\/]/.test(e[0])||(r=r.replace(/^[\\\/]{2,}/,"\\")),l.normalize(r)},l.relative=function(e,t){e=l.resolve(e),t=l.resolve(t);for(var n=e.toLowerCase(),r=t.toLowerCase(),o=s(t.split("\\")),i=s(n.split("\\")),a=s(r.split("\\")),c=Math.min(i.length,a.length),u=c,p=0;p<c;p++)if(i[p]!==a[p]){u=p;break}if(0==u)return t;var f=[];for(p=u;p<i.length;p++)f.push("..");return(f=f.concat(o.slice(u))).join("\\")},l._makeLong=function(e){if(!o.isString(e))return e;if(!e)return"";var t=l.resolve(e);return/^[a-zA-Z]\:\\/.test(t)?"\\\\?\\"+t:/^\\\\[^?.]/.test(t)?"\\\\?\\UNC\\"+t.substring(2):e},l.dirname=function(e){var t=u(e),n=t[0],r=t[1];return n||r?(r&&(r=r.substr(0,r.length-1)),n+r):"."},l.basename=function(e,t){var n=u(e)[2];return t&&n.substr(-1*t.length)===t&&(n=n.substr(0,n.length-t.length)),n},l.extname=function(e){return u(e)[3]},l.format=function(e){if(!o.isObject(e))throw new TypeError("Parameter 'pathObject' must be an object, not "+typeof e);var t=e.root||"";if(!o.isString(t))throw new TypeError("'pathObject.root' must be a string or undefined, not "+typeof e.root);var n=e.dir,r=e.base||"";return n?n[n.length-1]===l.sep?n+r:n+l.sep+r:r},l.parse=function(e){if(!o.isString(e))throw new TypeError("Parameter 'pathString' must be a string, not "+typeof e);var t=u(e);if(!t||4!==t.length)throw new TypeError("Invalid path '"+e+"'");return{root:t[0],dir:t[0]+t[1].slice(0,-1),base:t[2],ext:t[3],name:t[2].slice(0,t[2].length-t[3].length)}},l.sep="\\",l.delimiter=";";var d=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,g={};function h(e){return d.exec(e).slice(1)}g.resolve=function(){for(var e="",t=!1,n=arguments.length-1;n>=-1&&!t;n--){var r=n>=0?arguments[n]:process.cwd();if(!o.isString(r))throw new TypeError("Arguments to path.resolve must be strings");r&&(e=r+"/"+e,t="/"===r[0])}return(t?"/":"")+(e=i(e.split("/"),!t).join("/"))||"."},g.normalize=function(e){var t=g.isAbsolute(e),n=e&&"/"===e[e.length-1];return(e=i(e.split("/"),!t).join("/"))||t||(e="."),e&&n&&(e+="/"),(t?"/":"")+e},g.isAbsolute=function(e){return"/"===e.charAt(0)},g.join=function(){for(var e="",t=0;t<arguments.length;t++){var n=arguments[t];if(!o.isString(n))throw new TypeError("Arguments to path.join must be strings");n&&(e+=e?"/"+n:n)}return g.normalize(e)},g.relative=function(e,t){e=g.resolve(e).substr(1),t=g.resolve(t).substr(1);for(var n=s(e.split("/")),r=s(t.split("/")),o=Math.min(n.length,r.length),i=o,a=0;a<o;a++)if(n[a]!==r[a]){i=a;break}var c=[];for(a=i;a<n.length;a++)c.push("..");return(c=c.concat(r.slice(i))).join("/")},g._makeLong=function(e){return e},g.dirname=function(e){var t=h(e),n=t[0],r=t[1];return n||r?(r&&(r=r.substr(0,r.length-1)),n+r):"."},g.basename=function(e,t){var n=h(e)[2];return t&&n.substr(-1*t.length)===t&&(n=n.substr(0,n.length-t.length)),n},g.extname=function(e){return h(e)[3]},g.format=function(e){if(!o.isObject(e))throw new TypeError("Parameter 'pathObject' must be an object, not "+typeof e);var t=e.root||"";if(!o.isString(t))throw new TypeError("'pathObject.root' must be a string or undefined, not "+typeof e.root);return(e.dir?e.dir+g.sep:"")+(e.base||"")},g.parse=function(e){if(!o.isString(e))throw new TypeError("Parameter 'pathString' must be a string, not "+typeof e);var t=h(e);if(!t||4!==t.length)throw new TypeError("Invalid path '"+e+"'");return t[1]=t[1]||"",t[2]=t[2]||"",t[3]=t[3]||"",{root:t[0],dir:t[0]+t[1].slice(0,-1),base:t[2],ext:t[3],name:t[2].slice(0,t[2].length-t[3].length)}},g.sep="/",g.delimiter=":",e.exports=r?l:g,e.exports.posix=g,e.exports.win32=l},496:e=>{"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},384:e=>{e.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},539:(e,t,n)=>{var r=/%[sdj%]/g;t.format=function(e){if(!m(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(s(arguments[n]));return t.join(" ")}n=1;for(var o=arguments,i=o.length,a=String(e).replace(r,(function(e){if("%%"===e)return"%";if(n>=i)return e;switch(e){case"%s":return String(o[n++]);case"%d":return Number(o[n++]);case"%j":try{return JSON.stringify(o[n++])}catch(e){return"[Circular]"}default:return e}})),c=o[n];n<i;c=o[++n])g(c)||!b(c)?a+=" "+c:a+=" "+s(c);return a},t.deprecate=function(e,r){if(y(n.g.process))return function(){return t.deprecate(e,r).apply(this,arguments)};if(!0===process.noDeprecation)return e;var o=!1;return function(){if(!o){if(process.throwDeprecation)throw new Error(r);process.traceDeprecation?console.trace(r):console.error(r),o=!0}return e.apply(this,arguments)}};var o,i={};function s(e,n){var r={seen:[],stylize:c};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),d(n)?r.showHidden=n:n&&t._extend(r,n),y(r.showHidden)&&(r.showHidden=!1),y(r.depth)&&(r.depth=2),y(r.colors)&&(r.colors=!1),y(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=a),l(r,e,r.depth)}function a(e,t){var n=s.styles[t];return n?"["+s.colors[n][0]+"m"+e+"["+s.colors[n][1]+"m":e}function c(e,t){return e}function l(e,n,r){if(e.customInspect&&n&&j(n.inspect)&&n.inspect!==t.inspect&&(!n.constructor||n.constructor.prototype!==n)){var o=n.inspect(r,e);return m(o)||(o=l(e,o,r)),o}var i=function(e,t){if(y(t))return e.stylize("undefined","undefined");if(m(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}return h(t)?e.stylize(""+t,"number"):d(t)?e.stylize(""+t,"boolean"):g(t)?e.stylize("null","null"):void 0}(e,n);if(i)return i;var s=Object.keys(n),a=function(e){var t={};return e.forEach((function(e,n){t[e]=!0})),t}(s);if(e.showHidden&&(s=Object.getOwnPropertyNames(n)),x(n)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return u(n);if(0===s.length){if(j(n)){var c=n.name?": "+n.name:"";return e.stylize("[Function"+c+"]","special")}if(v(n))return e.stylize(RegExp.prototype.toString.call(n),"regexp");if(w(n))return e.stylize(Date.prototype.toString.call(n),"date");if(x(n))return u(n)}var b,S="",E=!1,T=["{","}"];return f(n)&&(E=!0,T=["[","]"]),j(n)&&(S=" [Function"+(n.name?": "+n.name:"")+"]"),v(n)&&(S=" "+RegExp.prototype.toString.call(n)),w(n)&&(S=" "+Date.prototype.toUTCString.call(n)),x(n)&&(S=" "+u(n)),0!==s.length||E&&0!=n.length?r<0?v(n)?e.stylize(RegExp.prototype.toString.call(n),"regexp"):e.stylize("[Object]","special"):(e.seen.push(n),b=E?function(e,t,n,r,o){for(var i=[],s=0,a=t.length;s<a;++s)z(t,String(s))?i.push(p(e,t,n,r,String(s),!0)):i.push("");return o.forEach((function(o){o.match(/^\d+$/)||i.push(p(e,t,n,r,o,!0))})),i}(e,n,r,a,s):s.map((function(t){return p(e,n,r,a,t,E)})),e.seen.pop(),function(e,t,n){return e.reduce((function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60?n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1]:n[0]+t+" "+e.join(", ")+" "+n[1]}(b,S,T)):T[0]+S+T[1]}function u(e){return"["+Error.prototype.toString.call(e)+"]"}function p(e,t,n,r,o,i){var s,a,c;if((c=Object.getOwnPropertyDescriptor(t,o)||{value:t[o]}).get?a=c.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):c.set&&(a=e.stylize("[Setter]","special")),z(r,o)||(s="["+o+"]"),a||(e.seen.indexOf(c.value)<0?(a=g(n)?l(e,c.value,null):l(e,c.value,n-1)).indexOf("\n")>-1&&(a=i?a.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+a.split("\n").map((function(e){return"   "+e})).join("\n")):a=e.stylize("[Circular]","special")),y(s)){if(i&&o.match(/^\d+$/))return a;(s=JSON.stringify(""+o)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=e.stylize(s,"string"))}return s+": "+a}function f(e){return Array.isArray(e)}function d(e){return"boolean"==typeof e}function g(e){return null===e}function h(e){return"number"==typeof e}function m(e){return"string"==typeof e}function y(e){return void 0===e}function v(e){return b(e)&&"[object RegExp]"===S(e)}function b(e){return"object"==typeof e&&null!==e}function w(e){return b(e)&&"[object Date]"===S(e)}function x(e){return b(e)&&("[object Error]"===S(e)||e instanceof Error)}function j(e){return"function"==typeof e}function S(e){return Object.prototype.toString.call(e)}function E(e){return e<10?"0"+e.toString(10):e.toString(10)}t.debuglog=function(e){if(y(o)&&(o=process.env.NODE_DEBUG||""),e=e.toUpperCase(),!i[e])if(new RegExp("\\b"+e+"\\b","i").test(o)){var n=process.pid;i[e]=function(){var r=t.format.apply(t,arguments);console.error("%s %d: %s",e,n,r)}}else i[e]=function(){};return i[e]},t.inspect=s,s.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},s.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.isArray=f,t.isBoolean=d,t.isNull=g,t.isNullOrUndefined=function(e){return null==e},t.isNumber=h,t.isString=m,t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=y,t.isRegExp=v,t.isObject=b,t.isDate=w,t.isError=x,t.isFunction=j,t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=n(384);var T=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function O(){var e=new Date,t=[E(e.getHours()),E(e.getMinutes()),E(e.getSeconds())].join(":");return[e.getDate(),T[e.getMonth()],t].join(" ")}function z(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.log=function(){console.log("%s - %s",O(),t.format.apply(t,arguments))},t.inherits=n(496),t._extend=function(e,t){if(!t||!b(t))return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e}},225:(e,t,n)=>{const r=n(520);var o,i,s,a,c,l,u,p,f="",d=0,g=null,h="00:00",m=null,y=(h="00:00",[]),v=[],b=[],w="",x=null,j=null;function S(){const e=["vp9","vp9.0","vp8","vp8.0","avc1","av1","h265","h264"],t=MediaRecorder.isTypeSupported,n=[];["webm","mp4","ogg","mov","avi","wmv","flv","mkv","ts","x-matroska"].forEach((r=>{const o=`video/${r}`;e.forEach((e=>{[`${o};codecs=${e}`,`${o};codecs=${e.toUpperCase()}`].forEach((e=>{t(e)&&n.push(e)}))})),t(o)&&n.push(o)})),b=n}async function E(){navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia?(T(),s=null,a=null,c=null,d=0,h="00:00",y=[],v=[],(c=await navigator.mediaDevices.getDisplayMedia(o)).getVideoTracks()[0].addEventListener("ended",(()=>{T()})),console.log("fe-webrtc mediaStream--",c),u&&(u.srcObject=c),s=new MediaRecorder(c,i),a=new MediaRecorder(c,i),s.ondataavailable=e=>{e.data.size>l&&(v=[e.data])},a.ondataavailable=e=>{e.data.size>l&&y.push(e.data)},s.start(),a.start(),d=(new Date).valueOf(),I(),g=setInterval((()=>{A()}),1e3),console.log("fe-webrtc begin--")):alert("当前浏览器不支持屏幕捕捉或是当前访问头不支持使用navigator.mediaDevices")}function T(){if(k(),c)for(let e of c.getTracks())e.stop();s&&"inactive"!==s.state&&s.stop(),a&&"inactive"!==a.state&&a.stop(),console.log("fe-webrtc stop--",h),C(),d=0,A("00:00")}function O(){s&&"inactive"!==s.state?(s.stop(),setTimeout((()=>{_(v),s.start()}),500)):_(v)}function z(){y.length?_(y):alert("请在结束共享后下载整片视频")}function k(){x&&(clearInterval(x),x=null),g&&(clearInterval(g),g=null),m&&(clearTimeout(m),m=null)}function _(e){if(null==e||0==e.length)return void alert("没有视频数据");let t=new Blob(e,{type:i.mimeType}),n=URL.createObjectURL(t);console.log("fe-webrtc create--",n);let r=document.createElement("a");r.style="display: none",r.href=n,r.download=`${(new Date).getTime()}.${function(){if(w)return w;let e=i.mimeType.split("/")[1];return e.includes(";")&&(e=i.mimeType.split("/")[1].split(";")[0]),e}()}`,document.body.appendChild(r),r.click(),p&&(p.controls="controls",p.src=n),setTimeout((()=>{window.URL.revokeObjectURL(n),document.body.removeChild(r)}),1e3)}function D(e){return e?parseInt(e)>9?parseInt(e):"0"+parseInt(e):"00"}function A(e=""){let t=document.querySelector(".fetab__block_timing"),n=e||function(){if(!d)return"00:00";var e=parseInt(((new Date).valueOf()-d)/1e3),t=0,n=0;e>=60&&(t=parseInt(e/60),e=parseInt(e%60),t>=60&&(n=parseInt(t/60),t=parseInt(t%60)));var r=D(e);return r=t>0?D(t)+":"+r:"00:"+r,n>0&&(r=D(n)+":"+r),r}();h=n,t.innerHTML=n}function C(){if(d){m&&(clearTimeout(m),m=null);let e=document.querySelector(".fetab__btn");e.style.width="unset",e.style.height="24px",e.style.lineHeight="24px"}}function I(){if(d){let e=document.querySelector(".fetab__btn");m=setTimeout((()=>{e.style.width=0,e.style.height=0,e.style.lineHeight=0}),3e3)}}function L(e,t=""){let n=document.createElement(e);return t.text&&(n.innerHTML=t.text),t.child&&n.append(...t.child),t.class&&(n.className=t.class),t.style&&(n.style.cssText=t.style),t.src&&(n.src=t.src),t.mouseover&&(n.onmouseover=t.mouseover),t.mouseenter&&(n.onmouseenter=t.mouseenter),t.mouseenter&&(n.onmouseleave=t.mouseleave),t.mouseout&&(n.onmouseout=t.mouseout),n}e.exports={init:async function(e="",t=""){await S(),i={audioBitsPerSecond:t.audioBitsPerSecond||128e3,videoBitsPerSecond:t.videoBitsPerSecond||25e5,mimeType:t.mimeType||b[0]||"video/webm"},l=t.videoSize||1024,o=t.constants||{audio:!0,video:!0},t.outputType&&(w=t.outputType),f=e,t.noRender||(j=null,function(){const e=L("div",{class:"fetab__block_timing",text:"00:00"}),t=L("img",{class:"fetab__block_img",src:r.resolve("/","./image/record.svg"),style:"width:18px;height:18px;margin-right:4px;"}),n=L("div",{class:"fetab__block",child:[t,e],style:"/* 布局 */width:100%;font-size: 14px;line-height:20px;display: flex;align-items: center;justify-content: center;"}),o=L("div",{class:"fetab__btn",style:"/* 布局 */height:24px;line-height:24px;display: flex;align-items: center;justify-content: center;transition: .3s all ease;overflow:hidden;"});let i=["开始共享","下载切片","下载整片","结束共享"];for(let e=0;e<i.length;e++){let t=L("div",{class:"fetab__btn_item",text:i[e],style:"padding: 0 8px;cursor: pointer;border-radius:6px;transition: .3s all ease-in",mouseover:function(){this.style.backgroundColor="#f5f5f6"},mouseout:function(){this.style.backgroundColor="transparent"}});switch(i[e]){case"开始共享":t.onclick=E;break;case"下载切片":t.onclick=O;break;case"下载整片":t.onclick=z;break;case"结束共享":t.onclick=T}o.appendChild(t)}if(j=L("div",{class:"fetab",child:[n,o],style:"position: fixed;top: 0px;left: 0;right: 0;z-index: 1200;margin: auto;padding: 4px 8px;width: fit-content;min-width:60px;background: #fff;border: 1px solid #f5f5f5;border-radius: 0px 0px 12px 12px;box-shadow: 0px 6px 8px 0px rgba(199, 199, 199, 0.16);/* 字体 */font-size: 12px;line-height: 1.4;color: #28282a;opacity:0;transition:.3s opacity ease;",mouseenter:C,mouseleave:I}),document){const e=document.getElementById(f);e.parentNode.replaceChild(j,e),setTimeout((()=>{j.style.opacity=1}),800)}}()),window.addEventListener("hashchange",(e=>{k(),j&&(document.body.removeChild(j),j=null)})),window.addEventListener("popstate",(e=>{k(),j&&(document.body.removeChild(j),j=null)})),u=document.getElementById("live"),p=document.getElementById("preview")},getSupports:S,startRecord:E,stopRecord:T,download:z,downloadPart:O,getBlobData:function(){return new Promise(((e,t)=>{const n={part:"",whole:""};try{y.length&&(n.whole=new Blob(y,{type:i.mimeType})),v.length&&(n.part=new Blob(v,{type:i.mimeType})),e(n)}catch{e({whole:"",part:"",wholeTimes:h})}console.log("fewebrtc backData--")}))}}}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}return n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n(10)})()));